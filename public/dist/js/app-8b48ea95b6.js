"use strict";angular.module("textAnalysis",["ngRoute","d3"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"./components/home/home.view.html",controller:"homeCtrl"}).when("/tweets/:handle",{templateUrl:"./components/tweets/tweets.view.html",controller:"tweetCtrl"}).when("/results/:handle/:id",{templateUrl:"./components/results/results.view.html",controller:"resultsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("textAnalysis").factory("twitterService",["$q","$http","$log","$routeParams",function(e,t,n,r){var o={resultsTweet:"",userTimeline:{},checkCache:function(e,t){angular.isDefined(o.userTimeline[e+"-"+t])||(o.userTimeline[e+"-"+t]=[])},loadTweets:function(r,i){o.checkCache(r,i);var a=e.defer();return o.userTimeline[r+"-"+i].length>0?a.resolve(o.userTimeline[r+"-"+i]):t.get("/api/"+r,{params:{timeline:i}}).success(function(e){a.resolve(e),o.userTimeline[r+"-"+i]=e}).error(function(e){n.log("Error: ",e),a.reject(e)}),a.promise},getSingleTweet:function(r){var i=e.defer();return t.get("/api/results/"+r).success(function(e){i.resolve(e),o.resultsTweet=e.text}).error(function(e){n.log("Error: ",e),i.reject(e)}),i.promise}};return o}]),angular.module("textAnalysis").factory("aylienService",["$q","$http","$log",function(e,t,n){var r={getSentiment:function(r){var o=encodeURIComponent(r),i=e.defer();return t.get("/api/tweets/sentiment/"+o).success(function(e){i.resolve(e)}).error(function(e){n.log("Error ",e),i.reject(e)}),i.promise},getHashtags:function(r){var o=encodeURIComponent(r),i=e.defer();return t.get("/api/tweets/hashtags/"+o).success(function(e){i.resolve(e)}).error(function(e){n.log("Error ",e),i.reject(e)}),i.promise},getEntities:function(r){var o=encodeURIComponent(r),i=e.defer();return t.get("/api/tweets/entities/"+o).success(function(e){i.resolve(e)}).error(function(e){n.log("Error ",e),i.reject(e)}),i.promise},getClasses:function(r){var o=encodeURIComponent(r),i=e.defer();return t.get("/api/tweets/classify/"+o).success(function(e){i.resolve(e)}).error(function(e){n.log("Error ",e),i.reject(e)}),i.promise},getConcepts:function(r){var o=encodeURIComponent(r),i=e.defer();return t.get("/api/tweets/concepts/"+o).success(function(e){i.resolve(e)}).error(function(e){n.log("Error ",e),i.reject(e)}),i.promise}};return r}]),angular.module("textAnalysis").factory("storageService",["$window","$log",function(e,t){return{setData:function(n,r){return e.localStorage.setItem(n,r),t.log("set "+n+" data: "+r),this},getData:function(n){return t.log("retreiving "+n+" data"),e.localStorage.getItem(n)}}}]),angular.module("textAnalysis").directive("wordcloud",["d3","$window",function(e,t){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(n,r,o){var i,a=angular.element(t).width(),s=1e3,l="Roboto",u=(a+s)/20;if(angular.isDefined(o.width)&&(a=o.width),angular.isDefined(o.height)&&(s=o.height),angular.isDefined(o.fontFamily)&&(l=o.fontFamily),angular.isDefined(o.fontSize)&&(u=1*o.fontSize||0),angular.isDefined(n.words)&&(i=n.words),angular.isDefined(n.words)&&angular.isArray(i))i=n.words;else if(angular.element(r).find("word").length>0){var c=angular.element(r).find("word");i=[],angular.forEach(c,function(e){i.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(r.text().length>0))return void r.text("wordcloud: Please define some words");i=r.text().split(","),r.text("")}if(!angular.isNumber(u)||0>=u)return void r.text("wordcloud: font-size attribute not valid. font-size "+o.fontSize+" -> "+u);var f=function(t){function o(t){var o=s/2,u=a/2,c=r[0];e.select(c).append("svg").attr("width",a).attr("height",s).append("g").attr("transform","translate("+u+","+o+")").selectAll("text").data(t).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",l).style("fill",function(e,t){return i(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){n.onClick({element:e})}).on("mouseover",function(e){n.onHover({element:e})})}var i=e.scale.category20();e.layout.cloud().size([a,s]).words(t.map(function(e){return{text:e,size:Math.random()*u}})).rotate(function(){return-90*~~(2*Math.random())}).font(l).fontSize(function(e){return e.size}).on("end",o).start()};f(i)}}}]),angular.module("textAnalysis").directive("resultsCloud",["d3","$window",function(e,t){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(n,r,o){var i,a=.5*angular.element(t).height(),s=.75*angular.element(t).width(),l="Roboto",u=200;if(angular.isDefined(o.width)&&(s=o.width),angular.isDefined(o.height)&&(a=o.height),angular.isDefined(o.fontFamily)&&(l=o.fontFamily),angular.isDefined(o.fontSize)&&(u=1*o.fontSize||0),angular.isDefined(n.words)&&(i=n.words),angular.isDefined(n.words)&&angular.isArray(i))i=n.words;else if(angular.element(r).find("word").length>0){var c=angular.element(r).find("word");i=[],angular.forEach(c,function(e){i.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(r.text().length>0))return void r.text("wordcloud: Please define some words");i=r.text().split(","),r.text("")}if(!angular.isNumber(u)||0>=u)return void r.text("wordcloud: font-size attribute not valid. font-size "+o.fontSize+" -> "+u);var f=function(t){function o(t){var o=a/2,u=s/2,c=r[0];e.select(c).append("svg").attr("width",s).attr("height",a).append("g").attr("transform","translate("+u+","+o+")").selectAll("text").data(t).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",l).style("fill",function(e,t){return i(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){n.onClick({element:e})}).on("mouseover",function(e){n.onHover({element:e})})}var i=e.scale.category20();e.layout.cloud().size([s,a]).words(t.map(function(e){return{text:e,size:Math.random()*u}})).rotate(function(){return-90*~~(2*Math.random())}).font(l).fontSize(function(e){return e.size}).on("end",o).start()};f(i)}}}]),angular.module("textAnalysis").controller("homeCtrl",["$scope","$anchorScroll","$location",function(e,t,n){e.scrollTo=function(e){n.hash(e),t()},e.showSideNav=function(){$(".button-collapse").sideNav({closeOnClick:!0})},e.userInput={timeline:"user"},e.loadTweets=function(){e.submitHandle.userInput.$valid&&n.path("/tweets/"+e.userInput.text).search({timeline:e.userInput.timeline})}}]),angular.module("textAnalysis").controller("tweetCtrl",["$routeParams","$scope","$log","$location","twitterService",function(e,t,n,r,o){t.loadingTweets=!0,t.timeline=o.timelineInput,t.loadResults=function(t,n){o.resultsTweet=t,r.path("/results/"+e.handle+"/"+n)},t.redirect=function(){r.url("/")},o.loadTweets(e.handle,e.timeline).then(function(r){if(n.log(r),!r.length||!r[0].user.hasOwnProperty("screen_name"))return void(t.invalidHandle=!0);t.twitterHandle=e.handle;var o=[];t.tweets=r,angular.forEach(t.tweets,function(e,t){o.push(e.text)});var i=o.join(""),a=i.replace(/@_&,+(?=\.)/g," ");t.words=a.match(/\S+/g),t.loadingTweets=!1}),t.correctTime=function(e){return new Date(Date.parse(e))}}]),angular.module("textAnalysis").controller("resultsCtrl",["$scope","$log","$routeParams","twitterService","aylienService","storageService",function(e,t,n,r,o,i){e.collapse=function(){$(".collapsible").collapsible({accordian:!0})},e.loadingSentiment=!0,e.loadingHashtags=!0,e.loadingEntities=!0,e.loadingClasses=!0,e.loadingConcepts=!0;var a=function(){e.words=function(){var e=r.resultsTweet.match(/\S+/g);return i.setData("tweet",r.resultsTweet),e}(),o.getSentiment(r.resultsTweet).then(function(t){e.sentiment=t,i.setData("sentiment",JSON.stringify(t)),e.loadingSentiment=!1}),o.getHashtags(r.resultsTweet).then(function(t){e.hashtags=t.hashtags,i.setData("hashtag",JSON.stringify(t.hashtags)),e.loadingHashtags=!1}),o.getEntities(r.resultsTweet).then(function(t){e.entities=t.entities,i.setData("entity",JSON.stringify(t.entities)),e.loadingEntities=!1}),o.getClasses(r.resultsTweet).then(function(t){e.categories=t.categories,i.setData("category",JSON.stringify(t.categories)),e.loadingClasses=!1}),o.getConcepts(r.resultsTweet).then(function(t){var n=Object.keys(t.concepts).length;1>n?null==e.concepts:(e.concepts=t.concepts,i.setData("concept",JSON.stringify(t.concepts))),e.loadingConcepts=!1})},s=function(){e.words=function(){var e=r.resultsTweet.match(/\S+/g);return e}(),e.sentiment=JSON.parse(i.getData("sentiment")),e.loadingSentiment=!1,e.hashtags=JSON.parse(i.getData("hashtag")),e.loadingHashtags=!1,e.entities=JSON.parse(i.getData("entity")),e.loadingEntities=!1,e.categories=JSON.parse(i.getData("category")),e.loadingClasses=!1,e.concepts=JSON.parse(i.getData("concept")),e.loadingConcepts=!1};""==r.resultsTweet?(r.resultsTweet=i.getData("tweet"),s()):a()}]);