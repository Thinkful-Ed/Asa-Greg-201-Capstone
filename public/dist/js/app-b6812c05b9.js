"use strict";angular.module("textAnalysis",["ngRoute","ngAnimate","d3"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"./components/home/home.view.html",controller:"homeCtrl"}).when("/tweets/:handle",{templateUrl:"./components/tweets/tweets.view.html",controller:"tweetCtrl"}).when("/results/:handle/:id",{templateUrl:"./components/results/results.view.html",controller:"resultsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("textAnalysis").factory("twitterService",["$q","$http","$log","$routeParams",function(e,t,n,r){var a={resultsTweet:"",userTimeline:{},checkCache:function(e,t){angular.isDefined(a.userTimeline[e+"-"+t])||(a.userTimeline[e+"-"+t]=[])},loadTweets:function(r,o){a.checkCache(r,o);var i=e.defer();return a.userTimeline[r+"-"+o].length>0?i.resolve(a.userTimeline[r+"-"+o]):t.get("/api/"+r,{params:{timeline:o}}).success(function(e){i.resolve(e),a.userTimeline[r+"-"+o]=e}).error(function(e){n.log("Error: ",e),i.reject(e)}),i.promise},getSingleTweet:function(r){var o=e.defer();return t.get("/api/results/"+r).success(function(e){o.resolve(e),a.resultsTweet=e.text}).error(function(e){n.log("Error: ",e),o.reject(e)}),o.promise}};return a}]),angular.module("textAnalysis").factory("aylienService",["$q","$http","$log","$routeParams",function(e,t,n,r){var a={analysisData:{},getSentiment:function(o){var i=encodeURIComponent(o),s=e.defer();return t.get("/api/tweets/sentiment/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].sentiment=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getHashtags:function(o){var i=encodeURIComponent(o),s=e.defer();return t.get("/api/tweets/hashtags/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].hashtags=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getEntities:function(o){var i=encodeURIComponent(o),s=e.defer();return t.get("/api/tweets/entities/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].entities=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getClasses:function(o){var i=encodeURIComponent(o),s=e.defer();return t.get("/api/tweets/classify/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].classes=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise},getConcepts:function(o){var i=encodeURIComponent(o),s=e.defer();return t.get("/api/tweets/concepts/"+i).success(function(e){s.resolve(e),a.analysisData[r.handle].concepts=e}).error(function(e){n.log("Error ",e),s.reject(e)}),s.promise}};return a}]),angular.module("textAnalysis").factory("storageService",["$window","$log",function(e,t){return{setData:function(n,r){return e.localStorage.setItem(n,r),t.log("set "+n+" data: "+r),this},getData:function(n){return t.log("retreiving "+n+" data"),e.localStorage.getItem(n)}}}]),angular.module("textAnalysis").directive("wordcloud",["d3","$window",function(e,t){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(n,r,a){var o,i=angular.element(t).width(),s=1e3,l="Roboto",u=(i+s)/20;if(angular.isDefined(a.width)&&(i=a.width),angular.isDefined(a.height)&&(s=a.height),angular.isDefined(a.fontFamily)&&(l=a.fontFamily),angular.isDefined(a.fontSize)&&(u=1*a.fontSize||0),angular.isDefined(n.words)&&(o=n.words),angular.isDefined(n.words)&&angular.isArray(o))o=n.words;else if(angular.element(r).find("word").length>0){var c=angular.element(r).find("word");o=[],angular.forEach(c,function(e){o.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(r.text().length>0))return void r.text("wordcloud: Please define some words");o=r.text().split(","),r.text("")}if(!angular.isNumber(u)||0>=u)return void r.text("wordcloud: font-size attribute not valid. font-size "+a.fontSize+" -> "+u);var d=function(t){function a(t){var a=s/2,u=i/2,c=r[0];e.select(c).append("svg").attr("width",i).attr("height",s).append("g").attr("transform","translate("+u+","+a+")").selectAll("text").data(t).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",l).style("fill",function(e,t){return o(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){n.onClick({element:e})}).on("mouseover",function(e){n.onHover({element:e})})}var o=e.scale.category20();e.layout.cloud().size([i,s]).words(t.map(function(e){return{text:e,size:Math.random()*u}})).rotate(function(){return-90*~~(2*Math.random())}).font(l).fontSize(function(e){return e.size}).on("end",a).start()};d(o)}}}]),angular.module("textAnalysis").directive("resultsCloud",["d3","$window",function(e,t){return{restrict:"E",scope:{width:"@",height:"@",fontFamily:"@",fontSize:"@",words:"=",onClick:"&",onHover:"&"},link:function(n,r,a){var o,i=.5*angular.element(t).height(),s=.75*angular.element(t).width(),l="Roboto",u=200;if(angular.isDefined(a.width)&&(s=a.width),angular.isDefined(a.height)&&(i=a.height),angular.isDefined(a.fontFamily)&&(l=a.fontFamily),angular.isDefined(a.fontSize)&&(u=1*a.fontSize||0),angular.isDefined(n.words)&&(o=n.words),angular.isDefined(n.words)&&angular.isArray(o))o=n.words;else if(angular.element(r).find("word").length>0){var c=angular.element(r).find("word");o=[],angular.forEach(c,function(e){o.push(angular.element(e).text()),angular.element(e).remove()})}else{if(!(r.text().length>0))return void r.text("wordcloud: Please define some words");o=r.text().split(","),r.text("")}if(!angular.isNumber(u)||0>=u)return void r.text("wordcloud: font-size attribute not valid. font-size "+a.fontSize+" -> "+u);var d=function(t){function a(t){var a=i/2,u=s/2,c=r[0];e.select(c).append("svg").attr("width",s).attr("height",i).append("g").attr("transform","translate("+u+","+a+")").selectAll("text").data(t).enter().append("text").style("font-size",function(e){return e.size+"px"}).style("font-family",l).style("fill",function(e,t){return o(t)}).attr("text-anchor","middle").attr("transform",function(e){return"translate("+[e.x,e.y]+") rotate("+e.rotate+")"}).text(function(e){return e.text}).on("click",function(e){n.onClick({element:e})}).on("mouseover",function(e){n.onHover({element:e})})}var o=e.scale.category20();e.layout.cloud().size([s,i]).words(t.map(function(e){return{text:e,size:Math.random()*u}})).rotate(function(){return-90*~~(2*Math.random())}).font(l).fontSize(function(e){return e.size}).on("end",a).start()};d(o)}}}]),angular.module("textAnalysis").controller("homeCtrl",["$scope","$anchorScroll","$location",function(e,t,n){e.scrollTo=function(e){n.hash(e),t()},e.showSideNav=function(){$(".button-collapse").sideNav({closeOnClick:!0})},e.userInput={timeline:"user"},e.loadTweets=function(){e.submitHandle.userInput.$valid&&n.path("/tweets/"+e.userInput.text).search({timeline:e.userInput.timeline})}}]),angular.module("textAnalysis").controller("tweetCtrl",["$routeParams","$scope","$log","$location","twitterService",function(e,t,n,r,a){t.loadingTweets=!0,t.timeline=a.timelineInput,t.loadResults=function(t,n){a.resultsTweet=t,r.path("/results/"+e.handle+"/"+n)},t.redirect=function(){r.url("/")},a.loadTweets(e.handle,e.timeline).then(function(r){if(n.log(r),!r.length||!r[0].user.hasOwnProperty("screen_name"))return void(t.invalidHandle=!0);t.twitterHandle=e.handle;var a=[];t.tweets=r,angular.forEach(t.tweets,function(e,t){a.push(e.text)});var o=a.join(""),i=o.replace(/@_&,+(?=\.)/g," ");t.words=i.match(/\S+/g),t.loadingTweets=!1}),t.correctTime=function(e){return new Date(Date.parse(e))}}]),angular.module("textAnalysis").controller("resultsCtrl",["$scope","$log","$routeParams","twitterService","aylienService","storageService",function(e,t,n,r,a,o){e.collapse=function(){$(".collapsible").collapsible({accordian:!0})},e.loadingSentiment=!0,e.loadingHashtags=!0,e.loadingEntities=!0,e.loadingClasses=!0,e.loadingConcepts=!0;var i=function(){e.words=function(){var e=r.resultsTweet.match(/\S+/g);return o.setData("tweet",r.resultsTweet),e}(),a.getSentiment(r.resultsTweet).then(function(t){e.sentiment=t,o.setData("sentiment",JSON.stringify(t)),e.loadingSentiment=!1}),a.getHashtags(r.resultsTweet).then(function(t){e.hashtags=t.hashtags,o.setData("hashtag",JSON.stringify(t.hashtags)),e.loadingHashtags=!1}),a.getEntities(r.resultsTweet).then(function(t){e.entities=t.entities,o.setData("entity",JSON.stringify(t.entities)),e.loadingEntities=!1}),a.getClasses(r.resultsTweet).then(function(t){e.categories=t.categories,o.setData("category",JSON.stringify(t.categories)),e.loadingClasses=!1}),a.getConcepts(r.resultsTweet).then(function(t){var n=Object.keys(t.concepts).length;1>n?null==e.concepts:(e.concepts=t.concepts,o.setData("concept",JSON.stringify(t.concepts))),e.loadingConcepts=!1})},s=function(){e.words=function(){var e=r.resultsTweet.match(/\S+/g);return e}(),e.sentiment=JSON.parse(o.getData("sentiment")),e.loadingSentiment=!1,e.hashtags=JSON.parse(o.getData("hashtag")),e.loadingHashtags=!1,e.entities=JSON.parse(o.getData("entity")),e.loadingEntities=!1,e.categories=JSON.parse(o.getData("category")),e.loadingClasses=!1,e.concepts=JSON.parse(o.getData("concept")),e.loadingConcepts=!1};""==r.resultsTweet?(r.resultsTweet=o.getData("tweet"),s()):i()}]);